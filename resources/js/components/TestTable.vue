<template>
    <div id="container"></div>
</template>

<script>
export default {
    data() {
        return {
            list: [
                "M 0.00,0.00 C 0.00,0.00 33.00,0.00 33.00,0.00 30.38,3.41 26.96,6.12 25.00,10.00 20.72,18.46 24.05,25.65 32.00,30.10 42.80,36.14 54.31,33.94 64.96,42.53 75.39,50.94 78.33,66.41 80.00,79.00 80.00,79.00 50.00,67.26 50.00,67.26 50.00,67.26 32.04,60.44 32.04,60.44 32.04,60.44 14.83,43.91 14.83,43.91 14.83,43.91 0.60,28.91 0.60,28.91 0.60,28.91 0.00,22.00 0.00,22.00 0.00,22.00 0.00,0.00 0.00,0.00 Z",
                "M 260.00,0.00 C 260.00,0.00 285.00,0.00 285.00,0.00 282.86,7.38 282.58,13.01 279.04,20.00 275.25,27.48 272.40,30.59 266.92,36.51 266.92,36.51 261.79,42.70 261.79,42.70 255.28,49.15 241.20,55.72 233.00,60.60 222.54,66.84 216.84,73.18 204.00,75.00 204.01,64.18 205.53,54.37 213.30,46.17 227.91,30.74 256.12,27.41 260.00,0.00 Z",
                "M 287.00,0.00 C 287.00,0.00 295.00,0.00 295.00,0.00 295.00,0.00 295.00,120.00 295.00,120.00 295.00,120.00 295.00,155.00 295.00,155.00 295.00,155.00 294.00,172.00 294.00,172.00 294.00,172.00 287.87,160.00 287.87,160.00 287.87,160.00 275.25,130.00 275.25,130.00 275.25,130.00 265.00,112.00 265.00,112.00 265.00,112.00 262.00,127.00 262.00,127.00 256.35,119.01 242.42,103.71 239.80,95.00 238.45,90.53 238.99,72.79 239.00,67.00 239.00,64.72 238.78,61.35 240.02,59.39 241.30,57.37 245.84,55.10 248.00,53.80 253.25,50.62 258.25,47.28 263.00,43.38 271.89,36.09 282.29,22.26 285.39,11.00 285.39,11.00 287.00,0.00 287.00,0.00 Z",
                "M 0.00,33.00 C 0.00,33.00 29.00,59.88 29.00,59.88 29.00,59.88 43.57,69.27 43.57,69.27 43.57,69.27 46.00,85.00 46.00,85.00 46.00,85.00 43.17,141.00 43.17,141.00 43.17,141.00 42.09,154.00 42.09,154.00 42.09,154.00 42.09,164.00 42.09,164.00 42.09,164.00 30.81,149.83 30.81,149.83 30.81,149.83 30.81,135.00 30.81,135.00 30.81,135.00 30.81,119.00 30.81,119.00 21.97,123.52 23.19,135.22 20.85,144.00 20.85,144.00 6.00,184.00 6.00,184.00 6.00,184.00 0.00,201.00 0.00,201.00 0.00,201.00 0.00,33.00 0.00,33.00 Z",
                "M 236.09,60.00 C 239.10,67.81 235.49,78.89 236.09,87.00 236.09,87.00 242.14,141.00 242.14,141.00 243.03,147.06 244.01,166.94 242.14,172.00 239.49,163.40 235.63,161.96 231.98,155.00 231.98,155.00 220.19,125.00 220.19,125.00 215.73,116.16 211.18,114.19 208.93,110.72 206.59,107.09 204.12,89.80 204.01,85.00 203.97,83.07 203.77,79.28 204.99,77.73 205.96,76.51 213.62,74.13 216.00,72.88 216.00,72.88 236.09,60.00 236.09,60.00 Z",
                "M 46.00,69.00 C 49.57,69.65 58.08,72.10 59.96,75.39 60.91,77.25 60.13,80.83 59.96,83.00 59.96,83.00 59.17,100.00 59.17,100.00 59.64,105.59 60.08,111.57 61.48,117.00 62.25,120.00 64.64,125.35 64.38,128.00 64.38,128.00 58.89,143.00 58.89,143.00 58.89,143.00 54.00,174.00 54.00,174.00 42.72,167.61 44.98,160.22 45.00,149.00 45.00,149.00 47.00,121.00 47.00,121.00 47.00,121.00 48.00,105.00 48.00,105.00 48.00,105.00 48.82,92.00 48.82,92.00 48.82,87.70 47.06,73.31 46.00,69.00 Z",
                "M 63.00,76.00 C 63.00,76.00 80.00,82.00 80.00,82.00 80.00,82.00 80.00,98.00 80.00,98.00 80.00,98.00 76.00,138.00 76.00,138.00 70.13,134.77 67.07,128.13 65.00,122.00 60.18,107.71 61.80,90.80 63.00,76.00 Z",
                "M 240.00,101.00 C 244.12,104.81 250.38,114.08 254.13,119.00 259.58,126.16 262.94,126.73 263.00,136.00 263.00,136.00 263.00,158.00 263.00,158.00 263.00,158.00 264.00,172.00 264.00,172.00 264.00,172.00 265.08,191.00 265.08,191.00 265.60,195.49 266.75,198.59 265.08,203.00 265.08,203.00 255.00,184.00 255.00,184.00 250.50,193.52 251.76,199.25 242.00,208.00 242.00,208.00 245.00,175.00 245.00,175.00 245.00,175.00 245.96,160.00 245.96,160.00 245.96,160.00 240.00,101.00 240.00,101.00 Z",
                "M 209.00,114.00 C 218.97,118.96 224.16,139.85 228.06,150.00 231.85,159.85 240.56,167.07 242.62,178.00 243.30,181.61 240.94,199.35 240.27,204.00 240.27,204.00 228.87,262.00 228.87,262.00 228.87,262.00 222.66,286.00 222.66,286.00 220.87,294.56 222.72,301.16 214.96,307.07 211.75,309.52 209.89,310.26 206.00,311.00 208.58,304.51 209.91,301.11 210.00,294.00 210.00,294.00 210.00,285.00 210.00,285.00 210.11,276.20 213.21,270.43 215.11,262.00 216.03,257.92 216.99,246.36 217.00,242.00 217.00,242.00 218.17,201.00 218.17,201.00 219.06,191.96 224.36,178.61 223.82,171.00 222.68,155.04 213.71,130.14 209.00,114.00 Z",
                "M 66.00,130.00 C 66.00,130.00 76.00,141.00 76.00,141.00 74.24,148.24 75.01,163.83 75.00,172.00 75.00,172.00 73.31,193.00 73.31,193.00 73.31,193.00 73.31,204.00 73.31,204.00 72.62,211.99 70.83,219.88 71.01,228.00 71.54,251.05 78.60,274.06 87.86,295.00 87.86,295.00 99.76,319.00 99.76,319.00 99.76,319.00 116.21,337.00 116.21,337.00 120.12,342.48 122.67,351.40 124.00,358.00 124.00,358.00 120.00,361.00 120.00,361.00 116.00,354.78 112.20,356.22 110.53,363.00 110.53,363.00 108.61,380.00 108.61,380.00 108.25,381.86 107.99,384.75 106.41,385.98 104.78,387.24 101.02,386.99 99.00,387.00 99.00,387.00 100.00,371.00 100.00,371.00 94.13,374.69 96.00,383.93 96.00,390.00 90.80,386.52 93.99,376.65 94.00,371.00 94.03,352.37 92.55,348.89 87.58,331.00 87.58,331.00 75.58,287.00 75.58,287.00 75.58,287.00 65.42,250.00 65.42,250.00 65.42,250.00 60.92,222.00 60.92,222.00 59.07,210.81 56.02,196.05 56.00,185.00 55.98,172.69 58.41,149.48 62.36,138.01 62.36,138.01 66.00,130.00 66.00,130.00 Z",
                "M 29.00,153.00 C 36.11,156.37 40.62,164.17 45.75,169.96 52.54,177.60 53.94,173.78 54.00,183.00 54.07,194.34 55.56,201.97 57.41,213.00 58.46,219.24 62.07,234.62 60.00,240.00 56.73,234.40 52.20,229.65 47.00,225.76 43.19,222.91 35.31,217.81 33.01,213.83 31.23,210.76 31.08,203.70 30.58,200.00 28.71,186.20 29.00,181.59 29.00,168.00 29.00,168.00 29.00,153.00 29.00,153.00 Z",
                "M 255.00,189.00 C 255.00,189.00 266.62,208.00 266.62,208.00 266.62,208.00 266.62,213.00 266.62,213.00 266.62,213.00 260.43,240.00 260.43,240.00 260.43,240.00 252.94,265.00 252.94,265.00 252.94,265.00 238.86,296.00 238.86,296.00 238.86,296.00 233.00,312.00 233.00,312.00 218.64,304.22 223.97,287.68 227.58,275.00 227.58,275.00 232.88,253.00 232.88,253.00 232.88,253.00 237.79,233.00 237.79,233.00 237.79,233.00 241.52,213.00 241.52,213.00 242.85,209.38 246.01,206.21 248.23,203.00 251.32,198.52 253.22,194.10 255.00,189.00 Z",
                "M 75.00,208.00 C 83.06,221.09 90.81,253.40 91.00,269.00 91.00,269.00 92.04,291.00 92.04,291.00 92.36,295.02 93.52,297.03 92.04,301.00 85.44,284.60 79.96,272.58 76.45,255.00 73.50,240.27 73.98,233.59 74.00,219.00 74.01,213.39 74.02,213.49 75.00,208.00 Z",
                "M 32.00,216.00 C 35.99,218.82 52.01,230.95 54.48,234.01 56.89,237.00 60.78,243.46 62.28,247.00 62.28,247.00 73.85,288.00 73.85,288.00 78.06,303.54 84.37,314.64 73.00,329.00 72.99,311.09 63.83,298.65 56.26,283.00 46.05,261.91 44.61,256.68 37.66,235.00 34.62,225.53 34.04,226.83 32.00,216.00 Z",
                "M 220.00,304.00 C 221.79,308.51 220.99,320.57 221.00,326.00 221.00,326.00 222.00,341.00 222.00,341.00 222.00,341.00 224.02,368.00 224.02,368.00 224.40,373.58 226.83,385.33 225.00,390.00 225.00,390.00 222.43,376.00 222.43,376.00 222.43,376.00 221.00,366.00 221.00,366.00 221.00,366.00 219.00,366.00 219.00,366.00 217.80,376.82 223.32,390.63 220.00,399.00 215.07,388.83 215.91,375.98 213.00,365.00 213.00,365.00 211.00,365.00 211.00,365.00 211.00,365.00 210.00,392.00 210.00,392.00 210.00,392.00 205.80,377.00 205.80,377.00 205.80,377.00 202.27,359.00 202.27,359.00 202.27,359.00 200.00,344.00 200.00,344.00 208.51,340.25 216.22,338.91 217.00,328.00 217.00,328.00 214.00,328.00 214.00,328.00 212.62,342.70 201.31,337.42 193.39,347.04 189.65,351.59 189.54,358.59 185.00,362.00 185.01,350.40 185.98,352.98 189.46,343.00 193.14,332.44 194.75,323.89 203.51,315.30 207.42,311.47 209.63,313.87 220.00,304.00 Z",
                "M 223.00,306.00 C 225.15,307.82 231.46,313.08 232.43,315.30 233.53,317.79 234.00,326.97 234.00,330.00 234.00,330.00 234.00,353.00 234.00,353.00 234.01,361.40 237.70,377.18 235.00,384.00 229.62,373.46 232.65,368.55 227.00,363.00 227.00,363.00 226.00,370.00 226.00,370.00 226.00,370.00 224.09,343.00 224.09,343.00 224.09,343.00 223.00,306.00 223.00,306.00 Z",
                "M 81.00,316.00 C 82.71,319.33 85.30,329.83 86.37,334.00 90.04,348.26 92.17,353.85 92.00,369.00 91.96,372.20 90.93,386.65 90.00,389.00 90.00,389.00 90.00,370.00 90.00,370.00 81.76,375.18 88.27,391.98 86.00,400.00 86.00,400.00 81.00,397.00 81.00,397.00 81.00,397.00 81.00,369.00 81.00,369.00 72.49,373.80 79.71,389.25 77.41,394.59 76.80,396.01 76.08,396.19 75.00,397.00 75.00,372.74 67.80,361.80 72.77,336.00 72.77,336.00 81.00,316.00 81.00,316.00 Z"
            ],
            dragItemId: null,
            rectCoordsY: 0,
            colorRect: "",
            
        };
    },
    methods: {
        getRandomColor() {
            var letters = "0123456789ABCDEF";
            var color = "#";
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        },
        
        

        onStart() {
            var width = window.innerWidth;
            var height = window.innerHeight;

            var stage = new Konva.Stage({
                container: "container",
                width: width,
                height: height
            });

            var layer = new Konva.Layer();

            stage.add(layer);

            var tempLayer = new Konva.Layer();
            stage.add(tempLayer);

            var path;
            var rectungle;
            var text;
            for (var i = 0; i < this.list.length; i++) {
                path = new Konva.Path({
                    x: 240,
                    y: 40,
                    fill: "blue",
                    data: this.list[i],
                    numPoints: 10,
                    innerRadius: 20,
                    outerRadius: 25,
                    shadowOffsetX: 1,
                    shadowOffsetY: 1
                });
                layer.add(path);
                rectungle = new Konva.Rect({
                    x: 50,
                    y: 25 + i * 25,
                    width: 10,
                    height: 10,
                    fill: this.getRandomColor(),
                    draggable: true
                });
                layer.add(rectungle);
                text = new Konva.Text({
                    x: 75,
                    y: 25 + i * 25,
                    draggable: false,
                    fill: "black",
                    text: "Запись №" + (i + 1)
                });
                layer.add(text);
            }
            layer.draw();

            stage.on("dragstart", function(e) {
                e.target.moveTo(tempLayer);
                this.colorRect = e.target.fill();
                //console.log(e.target);
                layer.draw();
            });

            var previousShape;
            stage.on("dragmove", function(evt) {
                var pos = stage.getPointerPosition();
                var shape = layer.getIntersection(pos);
                if (previousShape && shape) {
                    if (previousShape !== shape) {
                        // leave from old targer
                        previousShape.fire(
                            "dragleave",
                            {
                                type: "dragleave",
                                target: previousShape,
                                evt: evt.evt
                            },
                            true
                        );

                        // enter new targer
                        shape.fire(
                            "dragenter",
                            {
                                type: "dragenter",
                                target: shape,
                                evt: evt.evt
                            },
                            true
                        );
                        previousShape = shape;
                    } else {
                        previousShape.fire(
                            "dragover",
                            {
                                type: "dragover",
                                target: previousShape,
                                evt: evt.evt
                            },
                            true
                        );
                    }
                } else if (!previousShape && shape) {
                    previousShape = shape;
                    shape.fire(
                        "dragenter",
                        {
                            type: "dragenter",
                            target: shape,
                            evt: evt.evt
                        },
                        true
                    );
                } else if (previousShape && !shape) {
                    previousShape.fire(
                        "dragleave",
                        {
                            type: "dragleave",
                            target: previousShape,
                            evt: evt.evt
                        },
                        true
                    );
                    previousShape = undefined;
                }
            });
            stage.on("dragend", function(e) {
                var pos = stage.getPointerPosition();
                var shape = layer.getIntersection(pos);
                if (shape) {
                    previousShape.fire(
                        "drop",
                        {
                            type: "drop",
                            target: previousShape,
                            evt: e.evt
                        },
                        true
                    );
                }
                previousShape = undefined;
                e.target.destroy();
                layer.draw();
                tempLayer.draw();
            });

            stage.on("dragenter", function(e) {
                e.target.fill("red");
                layer.draw();
            });

            stage.on("dragleave", function(e) {
                e.target.fill("blue");
                layer.draw();
            });

            stage.on("dragover", function(e) {
                layer.draw();
            });

            stage.on("drop", function(e) {
                e.target.fill(this.colorRect);
                e.target.moveTo(tempLayer);
                this.colorRect = "";
                layer.draw();
            });

            
        }
        // handleDragStart(e) {
        //     e.target.fill("black");
        //     //const elem = this.$refs.second;
        //     //elem.
        //     //console.log(elem);
        // },
        // handleDragEnd(e) {
        //     e.target.fill("green");
        //     console.log(e.target._id);
        // },
        // handleDragOver(e) {
        //     // e.target.fill("red");
        // }
    },
    // beboreMount() {
    //     this.onStart()
    // }
    mounted() {
        this.onStart();
    }
};
</script>

<style>
body {
    margin: 0;
    padding: 0;
}
</style>
